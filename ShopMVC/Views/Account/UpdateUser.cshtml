@model ShopMVC.ViewModels.EditUserViewModel
@using Microsoft.AspNetCore.Identity;

@using ShopMVC.DAL.Entities;
@using ShopMVC.BLL.Interfaces.IServices;
@inject SignInManager<ApplicationUser> signInManager;
@inject IAuthService userService;
@{
    ViewData["Title"] = "Profile";
    Layout = "~/Views/Shared/_UserLayout.cshtml";

    var user = await userService.GetUserAsync(User.Identity.Name);
    var photoPath = ("~/images/" + user.Image) ?? "Choose file...";
}

<div class="row">
    <div class=" col-md-9 offset-md-1 mt-3">
        <form method="post" enctype="multipart/form-data" class="mt-3" asp-controller="Account" asp-action="UpdateUser">
            <div class="row">
                <div class="form-group">
                    <div class="col-md-12">
                        <img id="profileImage" src="/images/@Model.ExistingPhotoPath" style="width:300px" class="rounded output" alt="" />
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label asp-for="Image"></label>
                <div class="col-md-12">
                    <div class="custom-file position-static">
                        <input id="photoChanger" asp-for="Image" class="form-control custom-file-input">
                        <label class="custom-file-label" style="overflow:hidden">@photoPath</label>
                        <span asp-validation-for="Image" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="Email"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>
            <div class="form-group row">
                <label asp-for="FirstName"></label>
                <input asp-for="FirstName" class="form-control" />
                <span asp-validation-for="FirstName" class="text-danger"></span>
            </div>
            <div class="form-group row">
                <label asp-for="SecondName"></label>
                <input asp-for="SecondName" class="form-control" />
                <span asp-validation-for="SecondName" class="text-danger"></span>
            </div>
            <div class="form-group row">
                <label asp-for="DayOfBirth"></label>
                <input asp-for="DayOfBirth" class="form-control" />
                <span asp-validation-for="DayOfBirth" class="text-danger"></span>
            </div>

            <div class="form-group text-center">
                <p>
                    <a id="forgot-password" class="nav-link" asp-controller="Account" asp-action="ChangePassword">Do You Want To Change Your Password?</a>
                </p>
            </div>

            <div asp-validation-summary="All" class="text-danger"></div>

            <div class="form-group row">

                <div class="col-sm-12 d-flex justify-content-end">
                    <button id="buttonsProfile" value="Update" class="btn btn-primary mr-2">Update</button>
                    <a id="buttonsProfile" asp-controller="Account" asp-action="MyProfile" class="btn btn-primary">Cancel</a>
                </div>
            </div>


        </form>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(() => {
            $('#photoChanger').change(function () {
                const file = this.files[0];
                console.log(file);
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function (event) {
                        console.log(event.target.result);
                        $('.output').attr('src', event.target.result);
                    }
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $('.custom-file-input').on("change", function () {
                var fileName = $(this).val().split("\\").pop();
                $(this).next('.custom-file-label').html(fileName);
            });
        });
    </script>
}
